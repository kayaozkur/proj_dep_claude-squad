#!/bin/bash

# Check for any _pro files that are staged and remove them
staged_pro_files=$(git diff --cached --name-only | grep '_pro')
if [ -n "$staged_pro_files" ]; then
    echo "Warning: Found staged _pro files. Removing them from staging area:"
    echo "$staged_pro_files"
    echo "$staged_pro_files" | xargs git reset HEAD --
    echo "_pro files have been unstaged and push will continue."
fi

# Check for any _pro.go files in the commits being pushed
while read local_ref local_sha remote_ref remote_sha; do
    if [ "$local_sha" != "0000000000000000000000000000000000000000" ]; then
        if git show --pretty=format: --name-only "$local_sha" | grep -q '_pro\.go$'; then
            echo "Error: Found _pro.go files in commit $local_sha"
            echo "These files should not be pushed to the repository."
            echo "Please remove these files from your commits before pushing."
            git show --pretty=format: --name-only "$local_sha" | grep '_pro\.go$'
            exit 1
        fi
    fi
done

exit 0